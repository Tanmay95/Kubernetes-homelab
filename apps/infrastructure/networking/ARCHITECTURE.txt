================================================================================
    KUBERNETES NETWORKING ARCHITECTURE - CILIUM & GATEWAY API
    Proxmox Talos Lab Cluster (starbasestudio.uk)
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          EXTERNAL CLIENTS                                    â”‚
â”‚  ğŸŒ Internet Users    ğŸ‘¨â€ğŸ’» Developers    ğŸ“± Mobile Apps    ğŸ–¥ï¸  Admin Tools    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ HTTP/HTTPS Requests
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PHYSICAL NETWORK LAYER                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  IP: 192.168.1.101 (Internal)    IP: 192.168.1.102 (External)      â”‚   â”‚
â”‚  â”‚      â–²                                    â–²                          â”‚   â”‚
â”‚  â”‚      â”‚ ARP/NDP Announcements              â”‚ ARP/NDP Announcements   â”‚   â”‚
â”‚  â”‚      â”‚ (L2 Layer)                         â”‚ (L2 Layer)              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                    â”‚
          â”‚                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CILIUM CNI LAYER (cilium/ folder)                         â”‚
â”‚                    Namespace: kube-system                                    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“¦ CORE COMPONENTS:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Cilium Agent (DaemonSet on ALL nodes)                              â”‚    â”‚
â”‚  â”‚  â€¢ eBPF-based packet processing                                    â”‚    â”‚
â”‚  â”‚  â€¢ kube-proxy replacement (kubeProxyReplacement: true)             â”‚    â”‚
â”‚  â”‚  â€¢ Network policy enforcement                                      â”‚    â”‚
â”‚  â”‚  â€¢ Service load balancing (Maglev algorithm)                       â”‚    â”‚
â”‚  â”‚  â€¢ L7 protocol visibility                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Cilium Operator (Deployment)                                       â”‚    â”‚
â”‚  â”‚  â€¢ IP address management (IPAM mode: kubernetes)                   â”‚    â”‚
â”‚  â”‚  â€¢ Gateway API controller (io.cilium/gateway-controller)           â”‚    â”‚
â”‚  â”‚  â€¢ Node lifecycle management                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ IP Pool & L2 Announcements (CRDs)                                  â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  CiliumLoadBalancerIPPool: 192.168.1.100/28                        â”‚    â”‚
â”‚  â”‚  â”œâ”€ Available IPs: 192.168.1.101-192.168.1.114                     â”‚    â”‚
â”‚  â”‚  â””â”€ Assigned to LoadBalancer services                              â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  CiliumL2AnnouncementPolicy:                                       â”‚    â”‚
â”‚  â”‚  â”œâ”€ Announces service IPs via ARP/NDP                              â”‚    â”‚
â”‚  â”‚  â”œâ”€ Interfaces: eth*, enp*, ens*, wlan*                            â”‚    â”‚
â”‚  â”‚  â””â”€ Makes IPs reachable on local network                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Hubble Observability                                               â”‚    â”‚
â”‚  â”‚  â€¢ Network flow monitoring                                         â”‚    â”‚
â”‚  â”‚  â€¢ Service map visualization                                       â”‚    â”‚
â”‚  â”‚  â€¢ Security policy debugging                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  FILES: values.yaml, ip-pool.yaml, l2-policy.yaml, kustomization.yaml      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚ Provides networking foundation
                                   â”‚ Creates GatewayClass "cilium"
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               GATEWAY API LAYER (gateway/ folder)                            â”‚
â”‚               Namespace: gateway                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  ğŸ” CERTIFICATE MANAGEMENT:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ cert-manager Resources                                             â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  Issuer (selfsigned) â”€â”€â”€â”€â”€â”€â”                                       â”‚    â”‚
â”‚  â”‚  namespace: gateway         â”‚ Issues certificates                  â”‚    â”‚
â”‚  â”‚                            â”‚                                       â”‚    â”‚
â”‚  â”‚  Certificate (cert-starbase) â—„â”€â”€â”€â”€â”€â”˜                               â”‚    â”‚
â”‚  â”‚  â”œâ”€ DNS: *.starbasestudio.uk                                       â”‚    â”‚
â”‚  â”‚  â”œâ”€ DNS: starbasestudio.uk                                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ Algorithm: RSA 2048                                            â”‚    â”‚
â”‚  â”‚  â”œâ”€ Rotation: Automatic                                            â”‚    â”‚
â”‚  â”‚  â””â”€ Secret: cert-starbase (TLS certificate stored here)            â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  FILES: issuer-selfsigned.yaml, cert-starbase.yaml                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  ğŸšª GATEWAY RESOURCES:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Gateway: gateway-internal      â”‚  Gateway: gateway-external       â”‚    â”‚
â”‚  â”‚  IP: 192.168.1.101              â”‚  IP: 192.168.1.102               â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚    â”‚
â”‚  â”‚                                 â”‚                                  â”‚    â”‚
â”‚  â”‚  Listeners:                     â”‚  Listeners:                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚ HTTP (Port 80)         â”‚    â”‚  â”‚ HTTP (Port 80)         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ Host: *.starbasestudio â”‚    â”‚  â”‚ Host: *.starbasestudio â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ AllowedRoutes: All     â”‚    â”‚  â”‚ AllowedRoutes: All     â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚                                 â”‚                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚ HTTPS (Port 443)       â”‚    â”‚  â”‚ HTTPS (Port 443)       â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ Host: argocd.starbase* â”‚    â”‚  â”‚ Host: *.starbasestudio â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ TLS: Terminate         â”‚    â”‚  â”‚ TLS: Terminate         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ Cert: argocd-tls-secretâ”‚    â”‚  â”‚ Cert: cert-starbase    â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ AllowedRoutes: All     â”‚    â”‚  â”‚ AllowedRoutes: All     â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚                                 â”‚                                  â”‚    â”‚
â”‚  â”‚  USE CASE:                      â”‚  USE CASE:                       â”‚    â”‚
â”‚  â”‚  â€¢ ArgoCD UI                    â”‚  â€¢ Public web apps               â”‚    â”‚
â”‚  â”‚  â€¢ Admin tools                  â”‚  â€¢ APIs                          â”‚    â”‚
â”‚  â”‚  â€¢ Monitoring dashboards        â”‚  â€¢ Customer services             â”‚    â”‚
â”‚  â”‚  â€¢ Internal services            â”‚  â€¢ Internet-facing apps          â”‚    â”‚
â”‚  â”‚                                 â”‚                                  â”‚    â”‚
â”‚  â”‚  FILE: gw-internal.yaml         â”‚  FILE: gw-external.yaml          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  GatewayClass: cilium (Managed by Cilium, not in gateway/ folder)           â”‚
â”‚  Controller: io.cilium/gateway-controller                                    â”‚
â”‚                                                                              â”‚
â”‚  FILES: ns.yaml, gw-internal.yaml, gw-external.yaml, cert-starbase.yaml,    â”‚
â”‚         issuer-selfsigned.yaml, kustomization.yaml                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ Provides ingress routing
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     APPLICATION ROUTING LAYER                                â”‚
â”‚                     (HTTPRoute Resources)                                    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  Applications in various namespaces create HTTPRoute resources:             â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ HTTPRoute: argocd    â”‚  â”‚ HTTPRoute: homepage  â”‚  â”‚ HTTPRoute: app-x â”‚  â”‚
â”‚  â”‚ Namespace: argocd    â”‚  â”‚ Namespace: homepage  â”‚  â”‚ Namespace: app-x â”‚  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â”‚
â”‚  â”‚ Host:                â”‚  â”‚ Host:                â”‚  â”‚ Host:            â”‚  â”‚
â”‚  â”‚  argocd.starbase*    â”‚  â”‚  home.starbase*      â”‚  â”‚  app.starbase*   â”‚  â”‚
â”‚  â”‚                      â”‚  â”‚                      â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚ ParentRef:           â”‚  â”‚ ParentRef:           â”‚  â”‚ ParentRef:       â”‚  â”‚
â”‚  â”‚  gateway-internal â—„â”€â”€â”¼â”€â”€â”¼â”€â”€gateway-external â—„â”€â”€â”¼â”€â”€â”¼â”€gateway-externalâ”‚  â”‚
â”‚  â”‚  (namespace: gateway)â”‚  â”‚  (namespace: gateway)â”‚  â”‚ (namespace: gw)  â”‚  â”‚
â”‚  â”‚                      â”‚  â”‚                      â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚ Backend:             â”‚  â”‚ Backend:             â”‚  â”‚ Backend:         â”‚  â”‚
â”‚  â”‚  Service: argocd-svc â”‚  â”‚  Service: homepage   â”‚  â”‚  Service: app-svcâ”‚  â”‚
â”‚  â”‚  Port: 80            â”‚  â”‚  Port: 3000          â”‚  â”‚  Port: 8080      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  These are defined in: my-apps/*/http-route.yaml                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      KUBERNETES SERVICES LAYER                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Service: argocd  â”‚  â”‚ Service: homepageâ”‚  â”‚ Service: app-x           â”‚  â”‚
â”‚  â”‚ Type: ClusterIP  â”‚  â”‚ Type: ClusterIP  â”‚  â”‚ Type: LoadBalancer       â”‚  â”‚
â”‚  â”‚ Port: 80         â”‚  â”‚ Port: 3000       â”‚  â”‚ Port: 8080               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                     â”‚                     â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚                     â”‚
            â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          POD LAYER                                           â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ArgoCD Pod   â”‚  â”‚ Homepage Pod â”‚  â”‚ App Pod 1    â”‚  â”‚ App Pod 2    â”‚   â”‚
â”‚  â”‚ Namespace:   â”‚  â”‚ Namespace:   â”‚  â”‚ Namespace:   â”‚  â”‚ Namespace:   â”‚   â”‚
â”‚  â”‚   argocd     â”‚  â”‚   homepage   â”‚  â”‚   app-x      â”‚  â”‚   app-x      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
                         TRAFFIC FLOW EXAMPLE
================================================================================

Example: User accesses https://homepage.starbasestudio.uk

1. DNS Resolution â†’ 192.168.1.102 (External Gateway IP)

2. Client sends HTTPS request to 192.168.1.102:443
   
3. CILIUM CNI LAYER (cilium/)
   â”œâ”€ L2 Announcement makes 192.168.1.102 reachable via ARP
   â”œâ”€ Cilium agent intercepts traffic at 192.168.1.102
   â””â”€ Identifies target as Gateway resource

4. GATEWAY API LAYER (gateway/)
   â”œâ”€ gateway-external receives traffic on HTTPS listener
   â”œâ”€ TLS termination using cert-starbase certificate
   â”œâ”€ Matches hostname: homepage.starbasestudio.uk
   â”œâ”€ Finds HTTPRoute for homepage in homepage namespace
   â””â”€ Routes to backend service: homepage:3000

5. CILIUM CNI LAYER (cilium/)
   â”œâ”€ eBPF handles service load balancing
   â”œâ”€ Selects healthy pod from homepage service
   â””â”€ Forwards decrypted HTTP traffic to pod

6. APPLICATION POD
   â”œâ”€ Homepage pod receives HTTP request
   â”œâ”€ Processes request and generates response
   â””â”€ Sends response back through same path

7. Response flows back through Gateway with TLS encryption


================================================================================
                    FOLDER RESPONSIBILITY MATRIX
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Responsibility       â”‚ cilium/             â”‚ gateway/                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Network Foundation   â”‚ âœ… YES (Primary)    â”‚ âŒ NO                        â”‚
â”‚ CNI Plugin           â”‚ âœ… YES              â”‚ âŒ NO                        â”‚
â”‚ IP Address Pool      â”‚ âœ… YES              â”‚ âŒ NO                        â”‚
â”‚ L2 Announcements     â”‚ âœ… YES              â”‚ âŒ NO                        â”‚
â”‚ kube-proxy Replace   â”‚ âœ… YES              â”‚ âŒ NO                        â”‚
â”‚ Service Load Balance â”‚ âœ… YES              â”‚ âŒ NO                        â”‚
â”‚ Gateway Controller   â”‚ âœ… YES (Provider)   â”‚ âŒ NO                        â”‚
â”‚ Gateway Resources    â”‚ âŒ NO               â”‚ âœ… YES (Consumers)           â”‚
â”‚ HTTP/HTTPS Routing   â”‚ âŒ NO               â”‚ âœ… YES                       â”‚
â”‚ TLS Certificates     â”‚ âŒ NO               â”‚ âœ… YES                       â”‚
â”‚ Cert Management      â”‚ âŒ NO               â”‚ âœ… YES                       â”‚
â”‚ Gateway Namespace    â”‚ âŒ NO               â”‚ âœ… YES                       â”‚
â”‚ Ingress Config       â”‚ âŒ NO               â”‚ âœ… YES                       â”‚
â”‚ Namespace            â”‚ kube-system         â”‚ gateway                      â”‚
â”‚ Deployment Scope     â”‚ Cluster-wide        â”‚ Specific to HTTP/HTTPS       â”‚
â”‚ Update Frequency     â”‚ Low (stable)        â”‚ High (app changes)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
                      DEPLOYMENT SEQUENCE
================================================================================

Order of Operations (ArgoCD Sync Waves):

1. ğŸ”§ CILIUM CNI (cilium/)
   â””â”€ Wave 0: Deploy Cilium Helm chart, IP pools, L2 policies
      â””â”€ Creates GatewayClass "cilium"
      â””â”€ Establishes network foundation
      â””â”€ Makes LoadBalancer IPs available

2. ğŸšª GATEWAY INFRASTRUCTURE (gateway/)
   â””â”€ Wave 0: Create gateway namespace (ns.yaml)
   â””â”€ Wave 1: Deploy cert-manager issuer (issuer-selfsigned.yaml)
   â””â”€ Wave 2: Request certificates (cert-starbase.yaml)
   â””â”€ Wave 3: Deploy Gateway resources (gw-internal.yaml, gw-external.yaml)
      â””â”€ Gateways reference GatewayClass "cilium" from step 1
      â””â”€ Gateways use certificates from step 2

3. ğŸ“± APPLICATIONS (my-apps/*/http-route.yaml)
   â””â”€ Wave 4+: Deploy application HTTPRoutes
      â””â”€ HTTPRoutes reference Gateways from step 2
      â””â”€ Applications become accessible via configured hostnames


================================================================================
                         KEY DESIGN DECISIONS
================================================================================

âœ… Why Two Separate Folders?

1. SEPARATION OF CONCERNS
   â€¢ cilium/ = Infrastructure (low-level networking)
   â€¢ gateway/ = Platform (high-level routing)

2. DIFFERENT LIFECYCLE
   â€¢ Cilium: Rarely updated (stable foundation)
   â€¢ Gateway: Frequently updated (new apps, certificates, routes)

3. BLAST RADIUS CONTROL
   â€¢ Cilium issue = Network failure (severe)
   â€¢ Gateway issue = Ingress failure (isolated to HTTP/HTTPS)

4. TEAM OWNERSHIP
   â€¢ cilium/ = Infrastructure/Platform team
   â€¢ gateway/ = Platform/DevOps team
   â€¢ HTTPRoutes = Application teams

5. REUSABILITY
   â€¢ Single Cilium instance serves ALL networking needs
   â€¢ Gateways can be added/removed independently
   â€¢ Multiple Gateway resources share same Cilium infrastructure

6. TROUBLESHOOTING CLARITY
   â€¢ Can't reach service by IP? â†’ Check cilium/
   â€¢ Can't reach by hostname? â†’ Check gateway/
   â€¢ App not responding? â†’ Check application


================================================================================
                    GITOPS REPOSITORY STRUCTURE
================================================================================

terraform-proxmox/
â””â”€â”€ apps/
    â””â”€â”€ infrastructure/
        â””â”€â”€ networking/
            â”œâ”€â”€ cilium/                    â† Foundation Layer (Layer 3-4)
            â”‚   â”œâ”€â”€ values.yaml            â”‚  Cilium configuration
            â”‚   â”œâ”€â”€ ip-pool.yaml           â”‚  192.168.1.100/28 pool
            â”‚   â”œâ”€â”€ l2-policy.yaml         â”‚  ARP/NDP announcements
            â”‚   â””â”€â”€ kustomization.yaml     â”‚  Helm deployment
            â”‚
            â””â”€â”€ gateway/                   â† Ingress Layer (Layer 7)
                â”œâ”€â”€ ns.yaml                â”‚  Gateway namespace
                â”œâ”€â”€ issuer-selfsigned.yaml â”‚  Cert issuer
                â”œâ”€â”€ cert-starbase.yaml     â”‚  Wildcard certificate
                â”œâ”€â”€ gw-internal.yaml       â”‚  Internal gateway (101)
                â”œâ”€â”€ gw-external.yaml       â”‚  External gateway (102)
                â””â”€â”€ kustomization.yaml     â”‚  Resource orchestration


================================================================================
                          SUMMARY
================================================================================

ğŸ¯ CILIUM (cilium/):
   Foundation networking layer providing IP management, load balancing,
   service mesh capabilities, and Gateway API controller implementation.
   
ğŸ¯ GATEWAY (gateway/):
   Application ingress layer providing HTTP/HTTPS routing, TLS termination,
   and certificate management for external access to cluster services.

ğŸ¤ TOGETHER:
   Cilium provides the engine, Gateway provides the steering wheel.
   Cilium makes networking possible, Gateway makes applications accessible.

================================================================================
